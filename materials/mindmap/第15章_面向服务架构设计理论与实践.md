# 第15章 面向服务架构设计理论与实践

- **15.1 SOA的概念**
  - **定义**
    - **应用角度**：一种应用框架，将业务功能划分为服务，实现业务流程灵活性
    - **原理角度**：一种组件模型，通过标准接口/契约将不同功能单元 (服务) 联系起来
  - **BPEL (Business Process Execution Language)**
    - 面向Web服务的业务流程执行语言，用于组合/编排Web Services

- **15.2 SOA的发展历史**
  - **15.2.1 三个阶段**
    - **萌芽阶段**：XML (数据描述/交换基石)
    - **标准化阶段**：Web Service三剑客 (SOAP, WSDL, UDDI)
    - **成熟应用阶段**：SCA/SDO/WS-Policy (编程模型与策略)
  - **15.2.2 微服务化发展**
    - **区别**：微服务更细粒度、独立进程、去中心化、通用接口 (REST)
    - **演进**：ESB (集中式总线) -> 微服务 (分布式/去中心化)

- **15.3 SOA参考架构 (IBM WebSphere)**
  - **6大类服务**
    - **连接服务 (Connectivity)**：ESB (企业服务总线)
    - **业务逻辑服务 (Business Logic)**：整合已有应用/信息、新应用开发
    - **控制服务 (Control)**：数据整合/流程整合/用户访问整合
    - **开发服务 (Development)**：建模/设计/实现/测试服务
    - **业务创新优化 (Innovation & Optimization)**：BPM、监控KPI
    - **IT服务管理**：安全/目录/系统管理/虚拟化
  - **企业服务总线 (ESB)**
    - **核心功能**：消息路由/寻址、协议转换、数据格式转换、服务发现
    - **模式**：总线结构，解耦请求者与提供者

- **15.4 主要协议和规范**
  - **UDDI (统一描述、发现和集成)**：服务注册中心
  - **WSDL (Web服务描述语言)**：XML格式描述服务 (操作/访问方式/地址)
  - **SOAP (简单对象访问协议)**：XML消息协议 (Envelope/Encoding/RPC/Binding)
  - **REST (表述性状态转移)**：
    - **风格**：资源 (URI)、表述 (JSON/XML)、状态转移 (HTTP动词)、超链接
    - **特征**：无状态、可缓存、统一接口

- **15.5 SOA设计标准**
  - **文档标准化**：XML
  - **通信协议**：SOAP/Messaging
  - **注册与集成**：Registry
  - **服务质量 (QoS)**：可靠性 (WS-Reliability)、安全性 (WS-Security)、策略 (WS-Policy)

- **15.6 SOA的作用**
  - 打破“信息孤岛”，实现资源共享
  - 保护现有IT投资 (封装遗留系统)
  - 业务灵活性 (快速响应变化)

- **15.7 设计原则**
  - **无状态**：不依赖上下文
  - **单一实例**：避免冗余
  - **明确定义接口**：WSDL契约稳定/隐藏实现
  - **自包含/模块化**：独立部署/管理
  - **粗粒度**：减少交互频度
  - **松耦合**：位置/技术透明
  - **互操作性**：基于标准

- **15.8 设计模式**
  - **15.8.1 服务注册表模式**：治理核心 (注册/查找/绑定)
  - **15.8.2 ESB模式**：中间件平台 (SynchroESB案例)
  - **15.8.3 微服务模式**
    - **聚合器微服务**：组合多个服务
    - **链式微服务**：A->B->C (同步阻塞风险)
    - **数据共享微服务**：过渡期共享DB (反规范)
    - **异步消息传递**：消息队列 (削峰/解耦)
    - **挑战**：分布式复杂性、分区数据库 (最终一致性)、运维/测试难度

- **15.9/15.10 实施过程与注意**
  - **集成需求**：应用/界面/流程/信息集成
  - **服务粒度**：外部接口粗粒度 (稳定)，内部细粒度 (灵活)
  - **无状态设计**：EJB Session Bean (无状态) 暴露为Web Service
  - **业务流程分析方法**：
    - **自顶向下**：领域分解 -> 业务组件 -> 服务候选者
    - **业务目标分析**：目标 -> 子目标 -> 服务 (KPI驱动)
    - **自底向上**：遗留系统资产分析 -> 包装为服务
  - **建模步骤**：建立业务对象 (实体/过程/事件) -> 建立服务接口 -> 建立业务流程 (BP模型/子流程)
