# 第10章 软件架构的演化和维护

- **10.1 演化与定义**
  - **10.1.1 重要性**
    - 维持架构有用性，适应环境/需求变化
    - 降低演化成本，保证一致性和正确性
  - **10.1.2 演化要素**
    - **组件演化**：模块增删改 (波及效应)
    - **连接件演化**：交互消息增删改
    - **约束演化**：拓扑关系/配置数据变化

- **10.2 面向对象架构演化过程**
  - **10.2.1 对象演化**
    - **AO (Add Object)**：添加对象 (新功能/解耦)
    - **DO (Delete Object)**：删除对象 (移除功能/合并)
  - **10.2.2 消息演化**
    - **AM/DM** (增/删消息), **SMO** (交换顺序), **OM** (反转收发), **CMM** (改变模块)
  - **10.2.3 复合片段演化** (控制流)
    - **AF/DF** (增/删片段), **FTC** (类型变更), **FCC** (条件变更)
    - 片段类型：ref, loop, break, alt, opt, par
  - **10.2.4 约束演化**
    - **AC/DC** (增/删约束)

- **10.3 演化方式分类**
  - **10.3.1 演化时期**
    - **设计时演化** (模型/代码编译前)
    - **运行前演化** (编译后执行前)
    - **有限制运行时演化** (特定约束下的安全模式)
    - **运行时演化** (最难，动态调整拓扑/组件)
  - **10.3.2 静态演化** (停机维护)
    - **过程**：理解 -> 需求变更分析 -> 计划 -> 重构 -> 测试
    - **原子操作**：
      - **可维护性相关**：AMD/RMD(依赖), AMI/RMI(接口), AM/RM(模块), SM/AGM(拆分/聚合)
      - **可靠性相关**：AMS/RMS(消息), AO/RO(对象), AF/RF/CF(片段), AU/RU(用例), AA/RA(角色)
    - **实例**：**正交软件架构** (分层线索化，变动仅影响单条线索)
  - **10.3.3 动态演化** (运行时)
    - **动态性等级**：交互动态性(L1), 结构动态性(L2), 架构动态性(L3, 重定义结构)
    - **两类技术**
      - **DSA (动态软件架构)**：架构在运行时变化
        - **步骤**：捕捉变化 -> 生成策略 -> 实施演化 -> 评估
        - **描述语言**：π-ADL (行为视角), Pilar (反射视角), LIME (协调视角)
        - **应用**：PKUAS (反射式中间件, 容器/微内核)
      - **DR (动态重配置)**：组件/连接件配置修改
        - **模式**：主从模式, 中央控制模式, C/S模式, 分布式控制模式

- **10.4 架构演化原则 (18条)**
  - **成本/进度/风险**：ECC (成本控制), Schedule Control, Risk Control
  - **系统特性**：主体维持 (AIG稳定), 结构优化 (可靠/性能), 平滑演化 (IWR稳定), 目标一致
  - **模块化**：独立演化 (局部化), 影响可控, 复杂性可控, 利于重构, 利于重用
  - **适应性**：遵从设计原则, 适应新技术 (TI), 环境适应性, 适应新需求
  - **合规/质量**：标准依从性, 质量向好 (QI)

- **10.5 演化评估方法**
  - **10.5.1 演化过程已知**
    - **方法**：度量演化前后版本，计算距离
    - **度量指标**：
      - **可维护性**：CCN (圈复杂度), FFC (扇入扇出), CBO (耦合度), RFC (响应), TCC/LCC (内聚度)
      - **可靠性**：风险率实数值
    - **距离计算**：向量距离 (可维护性), 实数差 (可靠性)
  - **10.5.2 演化过程未知**
    - **方法**：逆向推测演化操作，分析驱动因素与效果

- **10.6 大型网站架构演化实例**
  - **阶段1：单体架构** (LAMP/Java皆在一台)
  - **阶段2：垂直架构** (应用/DB/文件分离)
  - **阶段3：缓存改善** (本地缓存 + 远程分布式缓存)
  - **阶段4：服务集群** (负载均衡 LB)
  - **阶段5：数据库读写分离** (主从热备, 写主读从)
  - **阶段6：CDN + 反向代理** (加速响应)
  - **阶段7：分布式文件/数据库** (海量存储)
  - **阶段8：NoSQL + 搜索引擎** (非关系型/检索)
  - **阶段9：业务拆分** (产品线拆分, 消息队列)
  - **阶段10：分布式服务** (微服务化, 共用业务独立部署)

- **10.7 软件架构维护**
  - **知识管理**：架构设计 + 设计决策 (防止知识"沉没"/"腐蚀")
  - **修改管理**：建立隔离区域 (Region of Quiescence)
  - **版本管理**：演化控制与追溯
  - **可维护性度量实践**：基于组件图解析数据，计算CCN, FFC, CBO等指标
