# 第6章 数据库设计基础知识

- **6.1 数据库基本概念**
  - **6.1.1 发展阶段**
    - **人工管理**：数据不保存，不独立，无软件管理
    - **文件系统**：长期保存，有物理独立性，但冗余大，不一致，联系弱
    - **数据库系统 (DBS)**：结构化 (数据模型)，共享，高独立性 (逻辑/物理)，统一控制
  - **6.1.2 数据模型**
    - **三要素**：数据结构 (静态)、数据操作 (动态)、约束条件 (完整性)
    - **类型**
      - **层次模型**：树状结构，1:N，根节点唯一
      - **网状模型**：图状结构，M:N (需复合联系)，节点可多亲
      - **关系模型**：二维表，描述一致性，最主要
      - **新型**：NoSQL (非关系型，分布式，去ACID)
  - **6.1.3 DBMS 功能与特点**
    - **功能**：定义 (DDL)，操纵 (DML)，运行管理 (并发/安全/恢复)，组织存储，维护
    - **控制功能**：安全性 (Security)，完整性 (Integrality)，并发控制 (Concurrency)，故障恢复 (Recovery)
  - **6.1.4 三级模式结构**
    - **视图层 (外模式/用户模式)**：最高层抽象，用户看到的数据视图 (局部)
    - **逻辑层 (概念模式)**：全局逻辑结构，数据的"型"，相对稳定
    - **物理层 (内模式/存储模式)**：数据的物理存储和存取方式
    - **两级映像**：外模式/概念模式 (逻辑独立性)，概念模式/内模式 (物理独立性)

- **6.2 关系数据库**
  - **6.2.1 基本术语**
    - **属性/域**：列及其取值范围 (原子性 1NF)
    - **码 (Key)**
      - **候选码**：唯一标识元组的最小属性组
      - **主码 (PK)**：选定的一个候选码
      - **外码 (FK)**：引用其他关系的码
      - **全码**：所有属性组都是码
  - **完整性约束**
    - **实体完整性**：PK不可空，唯一
    - **参照完整性**：FK必须存在或为空
    - **用户定义完整性**：业务规则 (如年龄>0)
  - **6.2.2 关系运算**
    - **基本运算**：并 (U)、差 (-)、笛卡尔积 (×)、投影 (π)、选择 (σ)
    - **扩展运算**
      - **交** (∩)：R∩S = R-(R-S)
      - **连接 (Join)**
        - **θ连接**：满足条件通常是比较
        - **等值连接**：θ为"="
        - **自然连接**：同名属性等值连接 + 去除重复列
      - **除法 (÷)**：象集包含问题 (查询"至少包含所有...")
      - **外连接**：左外 (保左补空)、右外 (保右补空)、全外
  - **6.2.3 规范化理论 (重点)**
    - **函数依赖 (FD)**：X→Y (X决定Y)
      - **部分依赖**：Y依赖于X的一部分 (X是组合键)
      - **传递依赖**：X→Y→Z
    - **范式 (Normal Forms)**
      - **1NF**：属性原子性 (不可分)
        - *问题*：冗余大，更新异常，插入/删除异常
      - **2NF**：1NF + 消除 **非主属性** 对码的 **部分依赖**
      - **3NF**：2NF + 消除 **非主属性** 对码的 **传递依赖**
      - **BCNF**：3NF + 消除 **主属性** 对码的 **部分/传递依赖** (决定因素必包含码)
      - **4NF**：BCNF + 消除 **非平凡多值依赖** (X→→Y)

- **6.3 数据库设计**
  - **6.3.1 设计步骤**
    - 需求分析 -> 概念结构 -> 逻辑结构 -> 物理结构 -> 实施 -> 运行维护
  - **6.3.2 需求分析**
    - 工具：数据流图 (DFD)，数据字典 (DD)
    - 产出：信息要求，处理要求，安全/完整性要求
  - **6.3.3 概念结构设计**
    - **E-R 模型**：实体，属性，联系 (1:1, 1:N, M:N)
    - **设计策略**：自底向上 (局部E-R -> 全局E-R)
    - **合并冲突**
      - **属性冲突**：类型、取值范围、单位不同
      - **命名冲突**：同名异义，异名同义
      - **结构冲突**：同一对象抽象不同 (实体vs属性)
  - **6.3.4 逻辑结构设计**
    - **任务**：E-R图 -> 关系模式，规范化，用户视图
    - **转换规则**
      - **1:1**：合并到任意一端 (加FK)
      - **1:N**：合并到N端 (加FK)
      - **M:N**：转换为 **独立关系** (两端PK作为联合PK + 自己的属性)
    - **反规范化 (Denormalization)**
      - 目的：提高查询性能 (牺牲空间/写性能/一致性)
      - 手段：增加冗余列，派生列，表分割 (水平/垂直)
  - **6.3.5 物理结构设计**
    - 确定数据分布 (集中/分布式)
    - 确定存储结构 (索引，聚簇)
      - **聚簇索引**：物理顺序与索引顺序一致 (适合范围查询/特定列频繁排序)
  - **6.3.6 数据库实施**
    - 建立库结构 (DDL)，数据加载 (ETL)，试运行
  - **6.3.7 运行维护**
    - 性能监控，备份恢复，重组/重构

- **6.4 应用程序与数据库交互**
  - **6.4.1 库函数 (CLI/API)**：如 Oracle OCI (底层，依赖特定DB)
  - **6.4.2 嵌入式 SQL**：SQL嵌入宿主语言 (C/COBOL)，预编译，游标
  - **6.4.3 通用接口标准**
    - **ODBC** (Open DataBase Connectivity)：C语言标准，驱动管理器 + 驱动
    - **JDBC** (Java Database Connectivity)：Java API
    - **ADO.NET**：.NET框架，XML支持
  - **6.4.4 ORM (对象关系映射)**
    - 解决对象与关系异构问题
    - 框架：Hibernate (全自动)，MyBatis (半自动)，JPA (标准)

- **6.5 NoSQL 数据库**
  - **概念**：Not Only SQL, 非关系型，分布式，无ACID
  - **分类**
    - **列式存储** (HBase, Cassandra)：适合海量数据，分布式
    - **键值对 (Key-Value)** (Redis, Memcached)：简单，高性能查
    - **文档型** (MongoDB)：类JSON，schema-less
    - **图数据库** (Neo4j)：社交网络
  - **特征**：易扩展，大数据高性能，灵活模型，高可用 (CAP理论)
  - **CAP理论**：Consistency (一致性), Availability (可用性), Partition Tolerance (分区容错性) - 三选二
