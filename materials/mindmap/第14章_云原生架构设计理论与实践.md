# 第14章 云原生架构设计理论与实践

- **14.1 产生背景**
  - **云原生 (Cloud Native)**：应用生于云/长于云，最大化利用云平台弹性/分布式优势
  - **驱动力**：资源复用 (IaaS/PaaS)、开发效率 (DevOps/CI/CD)、业务创新 (AI/大数据/边缘计算)

- **14.2 云原生架构内涵**
  - **14.2.1 定义**
    - **核心**：代码结构变化 (业务代码 + 三方软件 + **非功能代码剥离**)
    - **特征**：轻量、敏捷、高度自动化
    - **变化**：
      - **代码结构**：不再关注底层文件/网络，转为调用云服务 (对象存储/数据库)
      - **非功能特性委托**：高可用/容灾/安全交由云设施 (虚拟机热迁移/容器自愈)
      - **高度自动化交付**：容器镜像标准化 + 不可变基础设施
  - **14.2.2 7大架构原则**
    - **服务化**：模块拆分 (微服务/小服务)，面向接口编程
    - **弹性**：随业务量自动伸缩，降低闲置成本
    - **可观测**：日志/链路/度量 (Logging/Tracing/Metrics)，关联分析
    - **韧性**：抵御故障能力的 (异步/重试/限流/熔断/多活)
    - **自动化**：IaC (基础设施即代码)、GitOps、CI/CD
    - **零信任**：以身份为中心，默认不信任 (即时认证授权)
    - **持续演进**：架构非封闭，需持续迭代/重构
  - **14.2.3 主要架构模式**
    - **服务化架构**：微服务/小服务 (接口契约、独立部署/迭代)
    - **Mesh化架构**：中间件下沉 (Sidecar)，业务与治理解耦 (Istio)
    - **Serverless模式**：全托管/事件驱动 (FaaS)，适合短任务/事件处理
    - **存储计算分离**：无状态应用 (弹性强) + 云存储 (Stateful)
    - **分布式事务**：
      - **XA** (强一致/性能差)
      - **BASE** (最终一致/高性能)
      - **TCC** (应用控事务/侵入强)
      - **SAGA** (补偿事务)
      - **SEATA** (AT模式/自动回滚)
    - **可观测架构**：SLO度量
    - **事件驱动架构 (EDA)**：解耦、韧性增强、CQRS、削峰填谷
  - **14.2.4 反模式**
    - **庞大单体**：耦合高、扩容难
    - **硬拆微服务**：规模小强拆、数据依赖未解耦、性能劣化 (网络调用)
    - **缺乏自动化**：人堆运维，风险高效率低

- **14.3 相关技术**
  - **14.3.1 容器技术**
    - **Docker**：应用打包规范 (镜像)，环境一致性，秒级启动
    - **Kubernetes (K8s)**：容器编排事实标准
      - **核心能力**：调度、部署/回滚、自愈、服务发现/LB、弹性伸缩
      - **组件**：APIServer (声明式API)、Controller、Scheduler、etcd
      - **扩展性**：CRD / Operator, CNI (网络), CSI (存储)
  - **14.3.2 云原生微服务**
    - **约束**：
      - **个体**：单一职责 (SRP)，独立业务域
      - **横向**：可发现性 (注册中心)、可交互性 (REST/RPC/IDL)
      - **纵向**：数据存储隔离 (DSS)，读写分离 (CQRS)
      - **全局**：自动化CI/CD，全链路可观测
    - **技术栈**：
      - **Dubbo** (高性能RPC)、**Spring Cloud** (全家桶)、**Tars** (腾讯多语言)
      - **SOFAStack** (金融级)、**Dapr** (分布式运行时)
  - **14.3.3 无服务器技术 (Serverless)**
    - **特征**：全托管、通用性、自动弹性、按量计费
    - **形态**：FaaS (函数计算) + BaaS (后端服务)
    - **关注点**：资源弹性调度 (白盒策略/冷启动优化)、负载均衡、安全 (隔离)
  - **14.3.4 服务网格 (Service Mesh)**
    - **特点**：基础设施层处理通信/安全/治理，应用无侵入 (Sidecar Proxy)
    - **Istio**：
      - **数据平面**：Envoy (拦截流量)
      - **控制平面**：Pilot (发现/配置)、Mixer (策略/监控)、Citadel (安全)
    - **其他**：Linkerd, Consul, Conduit

- **14.4 案例分析**
  - **某旅行公司**：混合云改造，资源利用率提升 (容器化/弹性)，DevOps演进
  - **某汽车公司**：数字化转型，私有云+公有云混合交付，业务中台构建
  - **某快递公司**：核心系统上阿里云 (VMware+Oracle -> K8s+云DB)，微服务拆分
  - **某电商业务**：大促稳定性 (容器弹性 + 链路追踪 + PTS压测 + AHAS限流)
  - **某体育用品公司**：全渠道业务中台 (共享服务中心：库存/订单/会员)，打破烟囱式系统
