# 第13章 层次式架构设计理论与实践

- **13.1 层次式体系结构概述**
  - **概念**：将系统组成为层次结构，每一层为上层服务，并作为下层客户
  - **常见分层**：表现层、中间层 (业务层)、数据访问层、数据层
  - **优缺点**
    - **优点**：结构清晰、易于复用、易于维护、关注分离
    - **缺点/注意事项**：
      - **污水池反模式** (Sinkhole)：请求穿透多层无业务逻辑 (>20%需考虑开放某些层)
      - **性能/复杂性**：层级过多导致性能下降、代码膨胀

- **13.2 表现层框架设计**
  - **13.2.1 设计模式**
    - **MVC (Model-View-Controller)**
      - **核心**：分离输入、处理、输出
      - **协作**：Controller接收请求 -> 调用Model -> 选择View显示
      - **优点**：多视图扩展、易维护
    - **MVP (Model-View-Presenter)**
      - **演变**：View与Model互不直接交互，通过Presenter中转
      - **特点**：便于单元测试 (Presenter依赖抽象View接口)
    - **MVVM (Model-View-ViewModel)**
      - **核心**：双向绑定 (DataBinding)
      - **ViewModel**：数据转换控制器，View与Model的桥梁 (解决UI种类多接口爆炸问题)
  - **13.2.2 XML设计表现层**
    - 统一Web Form与Windows Form外观 (XML描述GUI控件结构)
  - **13.2.3 UIP (User Interface Process)**
    - **UI Components**：用户交互、获取数据
    - **UIP Components**：协调UI、导航/工作流控制、状态管理 (分离实现与逻辑)
  - **13.2.4 动态生成设计**
    - 基于XML配置 + DOM API + 反射机制动态生成界面 (配置/定制/生成)

- **13.3 中间层架构设计 (业务逻辑)**
  - **13.3.1 业务逻辑组件**
    - **接口与实现**：面向接口编程，依赖注入 (IoC) DAO组件
    - **配置**：Spring容器管理，事务代理 (TransactionProxy)
  - **13.3.2 工作流设计**
    - **WFMC参考模型**：5个接口 (定义导入导出/客户端/应用调用/协作/管理监控)
  - **13.3.3 实体设计**
    - **表示方式**：XML、通用DataSet、有类型DataSet (强类型/编译检查)
  - **13.3.4 业务框架**
    - **模式**：Domain Model (领域模型) — Service (服务接口) — Control (服务控制器)

- **13.4 数据访问层设计**
  - **13.4.1 5种数据访问模式**
    - **在线访问**：直接连接占用
    - **DAO (Data Access Object)**：J2EE标准模式，抽象数据操作
    - **DTO (Data Transfer Object)**：跨进程传输数据容器 (无业务逻辑)
    - **离线数据模式**：独立于连接/数据源 (DataSet/SDO)
    - **O/R Mapping (ORM)**：对象-关系映射 (Hibernate)
  - **13.4.2 工厂模式应用**
    - 屏蔽多数据库差异 (SQL Server/Oracle/OleDb)
    - **结构**：IDAL接口 -> 具体DAL实现 -> DALFactory创建实例
  - **13.4.3 Hibernate & ORM**
    - **优势**：开发效率高、代码少、性能优化 (Cache)
  - **13.4.4 XML Schema**
    - 描述XML合法结构/类型/限制 (替代DTD)，支持继承和命名空间
  - **13.4.5 事务处理**
    - **ACID原则**：原子性、一致性、隔离性、持久性
    - **类型**：JDBC事务 (Connection控制)、JTA事务 (UserTransaction/分布式)
  - **13.4.6 连接对象管理**
    - **资源池 (Connection Pool)**：静态/动态分配策略，复用连接，提高性能

- **13.5 数据架构规划**
  - **融合设计**：数据库设计与类设计融合 / XML设计融合
  - **XML存储**：基于文件 (索引难/查询弱) vs 基于数据库 (结构化管理/高效)

- **13.6 物联网层次架构**
  - **感知层**：识别物体/采集信息 (RFID, 传感器, 二维码)
  - **网络层**：传递/处理信息 (融合网络, 云计算平台)
  - **应用层**：智能应用 (监控/查询/控制/扫描型)

- **13.7 案例分析**
  - **PetShop (.NET)**
    - **演化**：2.0 (无DAL) -> 3.0 (引入DAL/Factory) -> 4.0 (ASP.NET 2.0新特性/异步/缓存/Membership)
    - **架构**：Web -> BLL -> DAL (IDAL/DALFactory/SQL|OracleDAL) -> DB
  - **电子小票服务系统**
    - **三层架构**：感知层 (小票智能硬件) -> 网络层 (云平台) -> 应用层 (微信服务)
